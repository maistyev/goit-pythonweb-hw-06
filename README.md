# Система управління студентською базою даних

Цей проект реалізує базу даних для управління інформацією про студентів, групи, викладачів, предмети та оцінки з використанням PostgreSQL, SQLAlchemy та Alembic.

## Структура бази даних

База даних складається з таких таблиць:

1. **Групи (groups)** - інформація про навчальні групи
2. **Студенти (students)** - дані про студентів та їх належність до груп
3. **Викладачі (teachers)** - інформація про викладачів
4. **Предмети (subjects)** - навчальні предмети та викладачі, які їх ведуть
5. **Оцінки (grades)** - оцінки студентів з предметів з датою отримання

## Вимоги

- Python 3.7+
- Docker (для запуску PostgreSQL)
- PostgreSQL
- SQLAlchemy
- Alembic
- Faker

## Встановлення та запуск

### 1. Клонування репозиторію

```bash
git clone <repository-url>
cd goit-pythonweb-hw-06
```

### 2. Створення та активація віртуального середовища

```bash
python -m venv venv
source venv/bin/activate  # для Linux/macOS
# або
venv\Scripts\activate  # для Windows
```

### 3. Встановлення залежностей

```bash
pip install -r requirements.txt
```

### 4. Налаштування змінних середовища

Скопіюйте файл `.env.example` у файл `.env` та відредагуйте його згідно з вашими налаштуваннями:

```bash
cp .env.example .env
```

Відкрийте файл `.env` та змініть параметри підключення до бази даних, якщо потрібно:

```
POSTGRES_USER=postgres
POSTGRES_PASSWORD=ваш_пароль
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=student_db
```

### 5. Запуск PostgreSQL у Docker

```bash
docker run --name pg-student-db -p 5432:5432 -e POSTGRES_PASSWORD=mysecretpassword -d postgres
```

Почекайте, поки PostgreSQL запуститься, та створіть базу даних:

```bash
docker exec -it pg-student-db psql -U postgres -c "CREATE DATABASE student_db"
```

### 6. Налаштування та запуск міграцій

```bash
bash alembic_setup.sh
```

### 7. Заповнення бази даних тестовими даними

```bash
python seed.py
```

### 8. Виконання запитів до бази даних

```bash
python my_select.py
```

Або можна виконати всі кроки одразу за допомогою скрипту:

```bash
bash run_all.sh
```

## Структура проекту

- **models.py** - Моделі SQLAlchemy для таблиць бази даних
- **db.py** - Налаштування підключення до бази даних
- **seed.py** - Скрипт для заповнення бази даних випадковими даними
- **my_select.py** - Функції для виконання запитів до бази даних
- **alembic_setup.sh** - Скрипт для налаштування Alembic і створення міграцій
- **run_all.sh** - Скрипт для автоматизації всіх етапів налаштування і запуску
- **requirements.txt** - Залежності проекту
- **alembic/** - Конфігурація і міграції Alembic
- **.env** - Файл з конфіденційними даними підключення до бази даних (не включений у репозиторій)
- **.env.example** - Приклад файлу .env з шаблоном необхідних змінних середовища
- **.gitignore** - Список файлів, які не повинні відстежуватися системою контролю версій

## Реалізовані запити

У файлі `my_select.py` реалізовано такі запити:

1. **select_1()** - Знайти 5 студентів із найбільшим середнім балом з усіх предметів
2. **select_2(subject_id)** - Знайти студента із найвищим середнім балом з певного предмета
3. **select_3(subject_id)** - Знайти середній бал у групах з певного предмета
4. **select_4()** - Знайти середній бал на потоці (по всій таблиці оцінок)
5. **select_5(teacher_id)** - Знайти які курси читає певний викладач
6. **select_6(group_id)** - Знайти список студентів у певній групі
7. **select_7(group_id, subject_id)** - Знайти оцінки студентів у окремій групі з певного предмета
8. **select_8(teacher_id)** - Знайти середній бал, який ставить певний викладач зі своїх предметів
9. **select_9(student_id)** - Знайти список курсів, які відвідує певний студент
10. **select_10(student_id, teacher_id)** - Список курсів, які певному студенту читає певний викладач

## Використання запитів

Приклади виклику функцій для отримання даних:

```python
from my_select import select_1, select_4

# Отримати топ-5 студентів за середнім балом
top_students = select_1()
for student in top_students:
    print(f"{student.first_name} {student.last_name}: {student.avg_grade:.2f}")

# Отримати середній бал на потоці
avg_grade = select_4()
print(f"Середній бал на потоці: {avg_grade:.2f}")
```

## Дані для тестування

База даних заповнюється наступними тестовими даними:
- 3 групи: ПЗ-21, КІ-22, КН-23
- 5 викладачів з випадковими іменами
- 8 предметів (Математичний аналіз, Програмування, ...)
- 40 студентів, розподілених між групами
- 10-20 оцінок для кожного студента

## Особливості реалізації

- Використовується ORM SQLAlchemy для моделювання структури даних та роботи з базою
- Міграції бази даних управляються за допомогою Alembic
- Для генерації випадкових даних використовується бібліотека Faker з українською локалізацією
- SQL-запити будуються за допомогою конструкторів запитів SQLAlchemy

## Розробка та внесення змін

Якщо потрібно внести зміни в моделі даних:

1. Відредагуйте файл `models.py`
2. Створіть нову міграцію:
   ```bash
   alembic revision --autogenerate -m "Опис змін"
   ```
3. Застосуйте міграцію:
   ```bash
   alembic upgrade head
   ```